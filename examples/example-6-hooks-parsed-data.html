<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>afetch.js - Example 6: Hooks for Parsed Data</title>
  <script src="../src/afetch.js" defer></script>
  <!--For CDN: 
    <script src="https://cdn.jsdelivr.net/gh/naveedurrehman/afetch/dist/afetch.min.js" defer></script>
  -->
</head>

<body>

  <h1>afetch.js - Example 6: Hooks for Parsed Data</h1>

  <p>
    This example demonstrates the hook functions that run immediately after automated data parsing. The API returns the
    format specified by the sendme query parameter (json, text, blob, or js).
  </p>

  <ul>
    <li>
      <a fetch="https://www.naveedurrehman.com/afetch/api/parseddata/?sendme=json"
        fetch-onjson="({data}) => document.getElementById('infoHook').innerHTML = JSON.stringify(data, null, 2)">
        JSON Data Test (Example of in-line JS)
      </a>
    </li>
    <li>
      <a fetch='https://www.naveedurrehman.com/afetch/api/parseddata/?sendme=json' fetch-onjson="hookOnJSON">
        JSON Data Test (Example of global function)
      </a>
    </li>
    <li>
      <a fetch='https://www.naveedurrehman.com/afetch/api/parseddata/?sendme=text' fetch-ontext="hookOnText">
        Text Data Test
      </a>
    </li>
    </li>
    <li>
      <a fetch='https://www.naveedurrehman.com/afetch/api/parseddata/?sendme=blob' fetch-onblob="hookOnBlob">
        Blob Data Test
      </a>
    </li>
    <li>
      <a fetch='https://www.naveedurrehman.com/afetch/api/parseddata/?sendme=js' fetch-onjs="hookOnJS">
        <!--Use fetch-execjs="false" to disable automatic execution of JS codes-->
        JS Data Test (script will automatically run)
      </a>
    </li>
  </ul>

  <pre id="result"></pre>
  <pre id="infoHook"></pre>

  <script>

    function hookOnJSON(data) {
      document.getElementById('infoHook').innerHTML = JSON.stringify(data, null, 2);
      document.getElementById('result').innerHTML = "JSON data received.";
    }

    function hookOnText(data) {
      document.getElementById('infoHook').innerHTML = JSON.stringify(data, null, 2);
      document.getElementById('result').innerHTML = "Text data received."
    }

    function hookOnBlob({ data }) {
      document.getElementById('infoHook').innerHTML = '';
      document.getElementById('result').innerHTML = "Blob data received.";
      const url = URL.createObjectURL(data);
      const img = document.createElement("img");
      img.src = url;
      img.style.maxWidth = "200px";
      document.body.appendChild(img);
    }

    function hookOnJS(data) {
      document.getElementById('infoHook').innerHTML = JSON.stringify(data, null, 2);
      document.getElementById('result').innerHTML = "JS received and executed.";
    }

  </script>

</body>

</html>